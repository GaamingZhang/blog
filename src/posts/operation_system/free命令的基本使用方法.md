---
date: 2026-01-07
author: Gaaming Zhang
isOriginal: false
article: true
category:
  - 操作系统
tag:
  - 操作系统
---

# free命令的基本使用方法

## 1. 命令简介

`free`是Linux/Unix系统中用于显示系统内存使用情况的命令行工具。它能够实时查看系统的物理内存(RAM)、交换内存(swap)和内核缓冲区内存的使用状态，是系统管理员进行内存监控和性能调优的常用工具之一。

### 1.1 free命令的主要功能

- 显示系统总内存、已用内存、空闲内存和缓冲区内存的使用情况
- 支持以不同的单位（字节、KB、MB、GB等）显示内存信息
- 可以显示内存使用的百分比
- 支持连续监控内存变化
- 提供了多种输出格式和排序选项

### 1.2 free命令的应用场景

- 系统性能监控和故障排查
- 内存使用情况分析和优化
- 确定是否需要增加系统内存或调整交换分区
- 监控应用程序的内存消耗
- 自动化脚本中用于内存状态检查

## 2. 语法和参数

### 2.1 基本语法

```bash
free [选项]
```

### 2.2 常用参数详解

| 参数 | 简写 | 功能描述 |
|------|------|----------|
| `--bytes` | `-b` | 以字节(Byte)为单位显示内存使用情况 |
| `--kilo` | `-k` | 以千字节(KB)为单位显示内存使用情况（默认） |
| `--mega` | `-m` | 以兆字节(MB)为单位显示内存使用情况 |
| `--giga` | `-g` | 以吉字节(GB)为单位显示内存使用情况 |
| `--tera` | `-T` | 以太字节(TB)为单位显示内存使用情况 |
| `--human` | `-h` | 以人类可读的格式显示内存使用情况（自动选择合适的单位） |
| `--si` | `-H` | 与`-h`类似，但使用1000作为进制（而不是1024） |
| `--total` | `-t` | 显示内存总量（物理内存+交换内存） |
| `--wide` | `-w` | 以宽格式显示输出，包括更多详细信息 |
| `--seconds` | `-s <间隔>` | 每隔指定的秒数连续显示内存使用情况 |
| `--count` | `-c <次数>` | 与`-s`配合使用，指定连续显示的次数 |
| `--help` | 无 | 显示帮助信息 |
| `--version` | 无 | 显示命令版本信息 |

## 3. 输出解释

### 3.1 默认输出格式

当直接执行`free`命令时，输出如下所示：

```bash
              total        used        free      shared  buff/cache   available
Mem:        8168576     3258760     1650028      153216     3259788     4545892
Swap:       2097148           0     2097148
```

### 3.2 输出字段详解

#### 3.2.1 内存类型

- **Mem**: 物理内存(RAM)的使用情况
- **Swap**: 交换内存的使用情况

#### 3.2.2 内存统计字段

- **total**: 系统总内存大小
- **used**: 已使用的内存大小
- **free**: 完全空闲的内存大小
- **shared**: 被共享内存使用的内存大小
- **buff/cache**: 被缓冲区(buffer)和缓存(cache)使用的内存大小
- **available**: 可用内存大小（预估的可被新应用程序使用的内存大小）

### 3.3 宽格式输出

使用`-w`参数可以获得更详细的内存信息：

```bash
              total        used        free      shared     buffers       cache   available
Mem:        8168576     3258760     1650028      153216      123456     3136332     4545892
Swap:       2097148           0     2097148
```

宽格式将`buff/cache`拆分为：
- **buffers**: 内核缓冲区使用的内存
- **cache**: 内核页面缓存使用的内存

## 4. 内存概念解析

### 4.1 物理内存(RAM)和交换内存(Swap)

- **物理内存(RAM)**: 计算机的实际内存硬件，用于临时存储正在运行的程序和数据
- **交换内存(Swap)**: 当物理内存不足时，操作系统会将一部分不常用的内存数据转移到硬盘上的交换分区或交换文件中

### 4.2 缓冲区(Buffer)和缓存(Cache)

- **缓冲区(Buffer)**: 用于存储即将写入磁盘的数据，提高写入性能
- **缓存(Cache)**: 用于存储从磁盘读取的数据，提高读取性能

### 4.3 Used、Free和Available的区别

- **Used**: 已被应用程序和系统使用的内存
- **Free**: 完全未被使用的内存
- **Available**: 预估可被新应用程序使用的内存，包括Free内存和部分可回收的缓存内存

## 5. 实际使用示例

### 5.1 基本使用示例

```bash
# 默认以KB为单位显示内存信息
free

# 以人类可读的格式显示内存信息
free -h

# 以宽格式显示内存信息
free -w

# 以人类可读的宽格式显示内存信息
free -hw
```

### 5.2 连续监控内存变化

```bash
# 每2秒显示一次内存信息，持续10次
free -h -s 2 -c 10

# 每5秒显示一次内存信息，直到手动停止(Ctrl+C)
free -h -s 5
```

### 5.3 不同单位的显示

```bash
# 以字节为单位显示
free -b

# 以MB为单位显示
free -m

# 以GB为单位显示
free -g

# 以1000进制的人类可读格式显示
free -H
```

### 5.4 显示内存总量

```bash
# 显示物理内存和交换内存的总量
free -h -t
```

## 6. 最佳实践和注意事项

### 6.1 内存使用监控的最佳实践

1. **结合top命令使用**：`free`显示整体内存状态，`top`可以查看进程级别的内存使用
2. **定期监控**：在生产环境中设置定时任务，定期记录内存使用情况
3. **关注available指标**：相比free，available更能反映系统的实际可用内存
4. **注意交换内存使用**：频繁使用交换内存可能导致系统性能下降
5. **缓冲区和缓存的解读**：高缓冲区/缓存使用率通常是正常的，表明系统正在有效地利用内存

### 6.2 常见错误和解决方案

1. **内存使用率过高**
   - 检查是否有内存泄漏的进程
   - 考虑增加系统内存
   - 调整应用程序的内存分配

2. **交换内存频繁使用**
   - 增加物理内存
   - 调整`vm.swappiness`参数
   - 检查是否有进程占用过多内存

3. **可用内存过少**
   - 检查进程的内存消耗
   - 清理不必要的缓存
   - 考虑优化应用程序

### 6.3 与其他内存监控工具的结合使用

- **vmstat**：显示虚拟内存统计信息
- **top/htop**：显示进程级别的内存使用
- **ps**：查看单个进程的内存占用
- **sar**：收集和报告系统活动，包括内存使用
- **/proc/meminfo**：直接查看内核内存信息文件

## 7. 高频常见问题

### 7.1 free命令显示的"available"和"free"有什么区别？

**Free**表示完全未被使用的内存，而**Available**表示系统预估可以被新应用程序使用的内存，包括完全空闲的内存和部分可以回收的缓存内存。Available更能准确反映系统的实际可用内存，对于判断是否需要增加内存更有参考价值。

### 7.2 为什么free命令显示的"buff/cache"很高？

这通常是正常现象，表明Linux系统正在有效地利用内存进行磁盘缓存。当系统需要内存时，内核可以自动回收这些缓存内存供应用程序使用。高缓冲区/缓存使用率通常意味着更好的I/O性能。

### 7.3 如何判断系统是否需要增加内存？

主要考虑以下几个因素：
1. **Available内存持续过低**（例如低于总内存的10%）
2. **Swap内存频繁被使用**
3. **系统响应缓慢**或**应用程序卡顿**
4. **OOM（Out of Memory）错误**频繁出现
5. **内存使用率持续高于90%**

### 7.4 free命令的输出中"shared"是什么意思？

"shared"表示被tmpfs等共享内存文件系统使用的内存。这些内存可以被多个进程共享访问，常用于进程间通信(IPC)。

### 7.5 如何查看某个进程的内存使用情况？

可以结合`top`或`ps`命令查看单个进程的内存使用：

```bash
# 使用top命令实时查看进程内存使用
top

# 使用ps命令查看特定进程的内存使用
ps aux --sort=-%mem | head -10

# 使用pmap查看进程的内存映射
pmap -x <进程ID>
```

## 8. 总结

`free`命令是Linux系统中一个简单而强大的内存监控工具，它能够帮助系统管理员快速了解系统的内存使用情况。通过合理使用`free`命令的各种参数和选项，可以获得详细的内存统计信息，为系统性能优化和故障排查提供重要依据。

### 8.1 核心要点回顾

1. **命令功能**：`free`命令用于显示系统内存使用情况，包括物理内存、交换内存和缓冲区内存
2. **常用参数**：`-h`（人类可读格式）、`-t`（显示总量）、`-s`（连续监控）、`-w`（宽格式）
3. **关键指标**：关注`available`指标以了解系统实际可用内存
4. **内存类型**：区分物理内存、交换内存、缓冲区和缓存的不同用途
5. **最佳实践**：结合其他监控工具，定期监控内存变化，关注交换内存使用情况

通过掌握`free`命令的使用方法和内存概念，可以更好地管理系统内存资源，提高系统性能和稳定性。