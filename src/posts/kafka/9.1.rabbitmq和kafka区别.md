# rabbitmq和kafka区别

#### 面试口述要点（约 1 分钟）
- 定位与场景：RabbitMQ 偏企业消息中间件，低延迟、灵活路由、可靠性强；Kafka 偏高吞吐日志流平台，适合海量数据、流处理、日志/埋点/链路追踪。
- 架构模型：RabbitMQ 基于 AMQP，Exchange+Queue 路由，支持 direct/fanout/topic/headers；Kafka 基于分区日志，Producer 按分区写，Consumer 按 offset 拉取。
- 消费模型：RabbitMQ Push，支持 ACK/NACK/重回队列和死信队列；Kafka Pull，自主控制速率并支持批量拉取和反压。
- 顺序与分区：RabbitMQ 单队列可保序，但多队列或重试可能打乱；Kafka 分区内有序，分区间无序，Key 相同落同分区。
- 吞吐与延迟：Kafka 依赖顺序写、PageCache、批量/压缩，吞吐高；RabbitMQ 在复杂路由/持久化下吞吐较低但延迟更低。
- 可靠性与语义：RabbitMQ ACK+持久化；Kafka 支持副本、ACK=all、min.insync.replicas，语义可到 At least once/At most once/近似 Exactly once（幂等生产 + 事务 + EOS 消费）。
- 功能特性：RabbitMQ 原生延迟/死信、优先级队列、复杂路由；Kafka 原生无延迟队列（需定时轮询或基于定时器/外部组件），长积压更适合 Kafka。

#### 高频追问与简答
- 问：什么场景选 RabbitMQ，什么场景选 Kafka？
	答：低延迟、业务路由复杂、需要延迟/优先级/死信场景选 RabbitMQ；高吞吐日志/埋点/链路追踪/流式 ETL、可接受轻微延迟选 Kafka。

- 问：Kafka 如何保证数据不丢？
	答：主题多副本、ACK=all、min.insync.replicas>=2、禁用 unclean leader election，生产端重试+幂等，消费端提交位点前先落库/处理完成。

- 问：RabbitMQ 如何做到可靠投递？
	答：开启 Publisher Confirm、Mandatory/Return 检查路由失败，消息标记持久化，消费端 ACK/NACK，失败走死信队列。

- 问：Kafka 的 Exactly once 怎么做？
	答：生产端启用幂等 + 事务，消费端使用事务性写出并在同一事务提交位点（EOS），broker 配合 `transaction.state.log`；业务端仍需幂等落库兜底。

- 问：延迟消息怎么实现？
	答：RabbitMQ 使用延迟交换机或 TTL+死信；Kafka 原生无延迟，常见方案是分层 Topic（延迟等级）、定时任务轮询重发，或用基于 Kafka 的定时组件。

- 问：堆积和回放谁更合适？
	答：Kafka 天然支持长时间堆积与回放（保留策略），RabbitMQ 长期堆积性能下滑，适合实时低延迟场景。

