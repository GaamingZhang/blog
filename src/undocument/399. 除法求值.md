---
date: 2025-10-11
author: Gaaming Zhang
isOriginal: true
article: false
category: leetcode
tag:
  - leetcode
---

# 399. 除法求值

给你一个变量对数组 equations 和一个实数值数组 values 作为已知条件，其中 equations[i] = [Ai, Bi] 
 和 values[i] 共同表示等式 Ai / Bi = values[i] 。每个 Ai 或 Bi 是一个表示单个变量的字符串。
另有一些以数组 queries 表示的问题，其中 queries[j] = [Cj, Dj] 表示第 j 个问题，
 请你根据已知条件找出 Cj / Dj = ? 的结果作为答案。

```cpp
class Solution {
public:
    vector<double> calcEquation(vector<vector<string>>& equations, 
        vector<double>& values, vector<vector<string>>& queries) {
        unordered_map<string,int> nodeIndex;
        int count=0;
        for(int i=0;i<equations.size();++i){
            if(!nodeIndex.contains(equations[i][0])) nodeIndex[equations[i][0]]=count++;
            if(!nodeIndex.contains(equations[i][1])) nodeIndex[equations[i][1]]=count++;
        }
        vector<vector<double>> board(count,vector<double>(count,0));
        for(int i=0;i<equations.size();++i){
            board[nodeIndex[equations[i][0]]][nodeIndex[equations[i][1]]]=values[i];
            board[nodeIndex[equations[i][1]]][nodeIndex[equations[i][0]]]=1.0/values[i];
        }
        vector<double> res;
        for(int i=0;i<queries.size();++i){
            if(!nodeIndex.contains(queries[i][0]) || !nodeIndex.contains(queries[i][1])){
                res.push_back(-1.0);
            }else{
                vector<bool> visited(count,false);
                double resValue=search(board,visited,nodeIndex[queries[i][0]],
                    nodeIndex[queries[i][1]],count);
                res.push_back(resValue==0?-1:resValue);
            }
        }
        return res;
    }
private:
    double search(vector<vector<double>>& board,vector<bool>& visited, int x,int y,int count){
        if(x==y) return 1.0;
        for(int i=0;i<count;++i){
            if(visited[i] || board[x][i]==0 || x==i) continue;
            visited[x]=true;
            double subRes=search(board,visited,i,y,count);
            visited[x]=false;
            if(subRes!=0) return subRes*board[x][i];
        }
        return 0;
    }
};
```