---
date: 2025-12-31
author: Gaaming Zhang
isOriginal: true
article: true
category: leetcode
tag:
  - leetcode
  - 栈
---

# 224. 基本计算器

给你一个字符串表达式 s ，请你实现一个基本计算器来计算并返回它的值。
注意:不允许使用任何将字符串作为数学表达式计算的内置函数，比如 eval() 。
表达式仅包含非负整数，+、-、*、/、(、) 和空格。

示例 1：
输入：s = "1 + 1"
输出：2

示例 2：
输入：s = " 2-1 + 2 "
输出：3

示例 3：
输入：s = "(1+(4+5+2)-3)+(6+8)"
输出：23

## 解题思路

这道题需要实现一个基本计算器，支持加减法和括号。

### 栈处理括号

核心思路：使用栈处理括号内的符号变化。

1. **符号栈**：存储当前括号层级的符号
2. **当前符号**：根据栈顶元素确定当前数字的符号
3. **括号处理**：
   - 遇到 '('：将当前符号入栈
   - 遇到 ')'：弹出栈顶符号

### 符号处理规则

- '+'：当前符号 = 栈顶符号
- '-'：当前符号 = -栈顶符号
- '('：将当前符号入栈，新层级的符号继承当前符号
- ')'：弹出栈顶，恢复上一层级的符号

### 示例分析

`s = "(1+(4+5+2)-3)+(6+8)"`：
- 初始：ops = [1], sign = 1, ret = 0
- '('：ops = [1, 1]
- '1'：ret = 0 + 1*1 = 1
- '+'：sign = 1
- '('：ops = [1, 1, 1]
- '4'：ret = 1 + 1*4 = 5
- '+'：sign = 1
- '5'：ret = 5 + 1*5 = 10
- ...以此类推

## 代码实现

```cpp
class Solution {
public:
    int calculate(string s) {
        stack<int> ops;  // 符号栈，存储当前层级的符号
        ops.push(1);     // 初始符号为正
        
        int sign = 1;    // 当前符号
        int result = 0;  // 计算结果
        int n = s.size();
        int i = 0;
        
        while (i < n) {
            if (s[i] == ' ') {
                // 跳过空格
                ++i;
            } else if (s[i] == '+') {
                // 加号：当前符号 = 栈顶符号
                sign = ops.top();
                ++i;
            } else if (s[i] == '-') {
                // 减号：当前符号 = -栈顶符号
                sign = -ops.top();
                ++i;
            } else if (s[i] == '(') {
                // 左括号：将当前符号入栈
                ops.push(sign);
                ++i;
            } else if (s[i] == ')') {
                // 右括号：弹出栈顶符号
                ops.pop();
                ++i;
            } else {
                // 数字：解析完整数字并累加
                long num = 0;
                while (i < n && s[i] >= '0' && s[i] <= '9') {
                    num = num * 10 + s[i] - '0';
                    ++i;
                }
                result += sign * num;
            }
        }
        
        return result;
    }
};
```

## 复杂度分析

- **时间复杂度**：O(n)，其中 n 是字符串长度。只需遍历一次字符串。
- **空间复杂度**：O(n)，栈的空间，最坏情况下所有字符都是 '('。

## 总结

本题使用**栈处理括号**实现基本计算器。关键在于：

1. **符号栈**：存储每层括号的符号
2. **符号继承**：括号内的符号受括号外符号影响
3. **数字解析**：正确解析多位数字

这道题的核心是理解括号如何影响符号，使用栈可以优雅地处理嵌套括号。
