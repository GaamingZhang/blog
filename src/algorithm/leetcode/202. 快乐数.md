---
date: 2025-11-30
author: Gaaming Zhang
isOriginal: true
article: true
category: leetcode
tag:
  - leetcode
  - 哈希表
  - 双指针
---

# 202. 快乐数

编写一个算法来判断一个数 n 是不是快乐数。
「快乐数」 定义为：
对于一个正整数，每一次将该数替换为它每个位置上的数字的平方和。
然后重复这个过程直到这个数变为 1，也可能是 无限循环 但始终变不到 1。
如果这个过程 结果为 1，那么这个数就是快乐数。
如果 n 是 快乐数 就返回 true ；不是，则返回 false 。

示例 1：
输入：n = 19
输出：true
解释：
1² + 9² = 82
8² + 2² = 68
6² + 2² = 100
1² + 0² + 0² = 1

示例 2：
输入：n = 2
输出：false

## 解题思路

这道题的关键在于理解"快乐数"的定义和判断循环的方法。

### 核心问题

1. **如何判断是否为快乐数**：不断计算各位数字的平方和，直到结果为 1
2. **如何判断不是快乐数**：如果进入无限循环，则不是快乐数

### 关键观察

对于任意正整数，经过若干次变换后，结果必然：
- 最终变为 1（快乐数）
- 进入一个不包含 1 的循环（非快乐数）

**为什么不会无限增大？**
- 对于一个 n 位数，各位平方和的最大值是 n × 9² = 81n
- 当 n >= 4 时，81n < 10^(n-1)，即平方和一定小于原数
- 因此，对于任意输入，最终都会收敛到一个有限的范围内

### 解法一：哈希表检测循环

使用哈希表记录出现过的数字，如果某个数字重复出现，说明进入了循环。

### 解法二：快慢指针检测循环

类似于链表检测环的方法：
- 慢指针每次计算一次平方和
- 快指针每次计算两次平方和
- 如果快慢指针相遇，说明存在循环

## 代码实现

### 方法一：哈希表

```cpp
class Solution {
public:
    bool isHappy(int n) {
        unordered_set<int> seen;
        
        while (seen.find(n) == seen.end()) {
            seen.insert(n);
            int sum = 0;
            
            while (n > 0) {
                int digit = n % 10;
                n /= 10;
                sum += digit * digit;
            }
            
            n = sum;
            
            if (n == 1) {
                return true;
            }
        }
        
        return false;
    }
};
```

### 方法二：快慢指针

```cpp
class Solution {
public:
    bool isHappy(int n) {
        int slow = n;
        int fast = getNext(n);
        
        while (fast != 1 && slow != fast) {
            slow = getNext(slow);
            fast = getNext(getNext(fast));
        }
        
        return fast == 1;
    }
    
private:
    int getNext(int n) {
        int sum = 0;
        while (n > 0) {
            int digit = n % 10;
            n /= 10;
            sum += digit * digit;
        }
        return sum;
    }
};
```

### 代码详解

**方法一：哈希表**

1. 使用 `unordered_set` 存储已经出现过的数字
2. 循环条件：当前数字未在集合中出现过
3. 计算各位数字的平方和
4. 如果结果为 1，返回 true
5. 如果数字重复出现，退出循环，返回 false

**方法二：快慢指针**

1. `slow` 每次走一步，`fast` 每次走两步
2. 如果 `fast` 先到达 1，说明是快乐数
3. 如果 `slow == fast`，说明存在循环，不是快乐数

**计算平方和的过程**：
```
n = 19
digit = 19 % 10 = 9, n = 19 / 10 = 1, sum = 0 + 81 = 81
digit = 1 % 10 = 1, n = 1 / 10 = 0, sum = 81 + 1 = 82
结果：82
```

## 复杂度分析

**方法一：哈希表**
- 时间复杂度：O(log n)，数字的位数是 log n，循环次数有限
- 空间复杂度：O(log n)，哈希表存储的数字数量有限

**方法二：快慢指针**
- 时间复杂度：O(log n)
- 空间复杂度：O(1)，不需要额外空间

## 总结

本题是经典的"检测循环"问题。关键点在于：

1. **理解问题本质**：判断是否进入循环
2. **两种检测循环的方法**：哈希表和快慢指针
3. **数学性质**：任意数字最终都会收敛到有限范围

快慢指针方法更优雅，空间复杂度更优，是解决此类问题的经典思路。类似的思路可以应用于链表检测环、判断链表是否有环等问题。
